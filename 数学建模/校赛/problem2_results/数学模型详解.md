# 4通道到5通道颜色转换数学模型

## 模型概述

本数学模型解决了从4通道RGBV视频源到5通道RGBCX LED显示屏的颜色转换问题。核心目标是在保持视觉质量的前提下，实现色彩空间的维度扩展和色域映射。

## 1. 问题数学描述

### 1.1 输入输出定义

**输入空间**：4通道RGBV色彩空间
$$\mathbf{S} = \{(r, g, b, v) \mid 0 \leq r, g, b, v \leq 1\}$$

**输出空间**：5通道RGBCX色彩空间
$$\mathbf{T} = \{(r', g', b', c, x) \mid 0 \leq r', g', b', c, x \leq 1\}$$

**转换映射**：
$$f: \mathbf{S} \rightarrow \mathbf{T}$$
$$f(r, g, b, v) = (r', g', b', c, x)$$

### 1.2 优化目标

最小化颜色转换损失：
$$\min_{f} \sum_{i=1}^{N} \Delta E_i$$

其中 $\Delta E_i$ 是第i个像素的色差，N是总像素数。

## 2. 色度坐标转换

### 2.1 RGBV到CIE xy转换

**步骤1：RGB线性化**
$$RGB_{linear} = \begin{cases}
\frac{RGB_{sRGB}}{12.92} & \text{if } RGB_{sRGB} \leq 0.04045 \\
\left(\frac{RGB_{sRGB} + 0.055}{1.055}\right)^{2.4} & \text{if } RGB_{sRGB} > 0.04045
\end{cases}$$

**步骤2：RGB到XYZ转换**
$$\begin{bmatrix} X \\ Y \\ Z \end{bmatrix} = \begin{bmatrix}
0.4124564 & 0.3575761 & 0.1804375 \\
0.2126729 & 0.7151522 & 0.0721750 \\
0.0193339 & 0.1191920 & 0.9503041
\end{bmatrix} \begin{bmatrix} R_{linear} \\ G_{linear} \\ B_{linear} \end{bmatrix}$$

**步骤3：V通道影响**
$$Z' = Z + 0.3 \cdot v$$

**步骤4：XYZ到xy转换**
$$x = \frac{X}{X + Y + Z'}, \quad y = \frac{Y}{X + Y + Z'}$$

### 2.2 RGBCX到CIE xy转换

类似地，5通道转换包含C和X通道的影响：
$$X' = X + 0.2 \cdot c + 0.15 \cdot x$$
$$Y' = Y + 0.25 \cdot c$$

## 3. 色域边界检测

### 3.1 多边形内点判断

使用射线法判断点是否在多边形内：

对于点 $P(x_0, y_0)$ 和多边形顶点 $\{V_i(x_i, y_i)\}_{i=0}^{n-1}$：

$$\text{inside} = \text{false}$$

对每条边 $(V_i, V_{i+1})$：
$$\text{if } (y_i > y_0) \neq (y_{i+1} > y_0) \text{ and } x_0 < \frac{(x_{i+1} - x_i)(y_0 - y_i)}{y_{i+1} - y_i} + x_i$$
$$\text{then } \text{inside} = \neg\text{inside}$$

### 3.2 色域顶点定义

**4通道RGBV色域顶点**：
$$\mathbf{V}_{RGBV} = \begin{bmatrix}
0.708 & 0.292 \\  % R
0.170 & 0.797 \\  % G
0.131 & 0.046 \\  % B
0.280 & 0.330     % V
\end{bmatrix}$$

**5通道RGBCX色域顶点**：
$$\mathbf{V}_{RGBCX} = \begin{bmatrix}
0.640 & 0.330 \\  % R
0.300 & 0.600 \\  % G
0.150 & 0.060 \\  % B
0.225 & 0.329 \\  % C
0.313 & 0.329     % X
\end{bmatrix}$$

## 4. 核心转换算法

### 4.1 直接映射算法

对于目标色域内的颜色，使用直接映射：

$$\begin{bmatrix} r' \\ g' \\ b' \end{bmatrix} = 0.9 \cdot \begin{bmatrix} r \\ g \\ b \end{bmatrix}$$

$$c = 0.6 \cdot v$$
$$x = 0.4 \cdot v$$

### 4.2 智能压缩算法

**步骤1：计算色域重心**
$$\mathbf{C} = \frac{1}{5}\sum_{i=1}^{5} \mathbf{V}_i$$

**步骤2：压缩方向计算**
$$\mathbf{d} = \mathbf{P}_{source} - \mathbf{C}$$
$$\hat{\mathbf{d}} = \frac{\mathbf{d}}{|\mathbf{d}|}$$

**步骤3：边界交点计算**

对于射线 $\mathbf{r}(t) = \mathbf{C} + t\hat{\mathbf{d}}$ 和边界线段：

$$t = \frac{(\mathbf{P}_1 - \mathbf{C}) \times \mathbf{e}}{(\hat{\mathbf{d}} \times \mathbf{e})}$$

其中 $\mathbf{e} = \mathbf{P}_2 - \mathbf{P}_1$ 是边向量。

**步骤4：自适应压缩**
$$\alpha = \begin{cases}
0.85 & \text{if } v > 0.7 \\
0.90 & \text{otherwise}
\end{cases}$$

$$\mathbf{P}_{compressed} = \mathbf{C} + \alpha(\mathbf{P}_{boundary} - \mathbf{C})$$

## 5. V通道分解策略

### 5.1 分解权重

V通道能量分配到C和X通道：
$$E_C = 0.6 \cdot E_V$$
$$E_X = 0.4 \cdot E_V$$

### 5.2 数学依据

基于视觉感知和色域覆盖优化：
- C通道主要负责青色区域的扩展
- X通道提供额外的色域边界支撑

分解比例通过实验优化得出，可表示为：
$$\min_{w_C, w_X} \sum_{i} \|\mathbf{P}_{target,i} - \mathbf{P}_{mapped,i}(w_C, w_X)\|^2$$
$$\text{s.t. } w_C + w_X = 1, \quad w_C, w_X \geq 0$$

## 6. 色差评估模型

### 6.1 简化色差计算

$$\Delta E_{xy} = \sqrt{(x_1 - x_2)^2 + (y_1 - y_2)^2}$$

### 6.2 质量等级划分

$$Q = \begin{cases}
\text{优秀} & \text{if } \Delta E < 0.01 \\
\text{良好} & \text{if } 0.01 \leq \Delta E < 0.03 \\
\text{可接受} & \text{if } 0.03 \leq \Delta E < 0.06 \\
\text{较差} & \text{if } \Delta E \geq 0.06
\end{cases}$$

## 7. 优化目标函数

### 7.1 多目标优化

$$\min \mathbf{F}(\mathbf{f}) = \begin{bmatrix}
f_1(\mathbf{f}) \\
f_2(\mathbf{f}) \\
f_3(\mathbf{f})
\end{bmatrix}$$

其中：
- $f_1(\mathbf{f}) = \frac{1}{N}\sum_{i=1}^N \Delta E_i$ （平均色差）
- $f_2(\mathbf{f}) = \max_i \Delta E_i$ （最大色差）
- $f_3(\mathbf{f}) = \text{Var}(\Delta E)$ （色差方差）

### 7.2 约束条件

$$\text{s.t. } \begin{cases}
0 \leq r', g', b', c, x \leq 1 \\
\mathbf{P}_{target} \in \text{Gamut}_{RGBCX} \\
\|\mathbf{P}_{target} - \mathbf{P}_{source}\| \text{ 最小}
\end{cases}$$

## 8. 算法复杂度分析

### 8.1 时间复杂度

- 色度坐标转换：$O(1)$ 每像素
- 色域检测：$O(n)$ 每像素，n为多边形顶点数
- 边界交点计算：$O(n)$ 每像素
- 总体复杂度：$O(Nn)$，N为像素总数

### 8.2 空间复杂度

- 存储原始图像：$O(4N)$
- 存储转换结果：$O(5N)$
- 辅助数据结构：$O(n)$
- 总体空间复杂度：$O(N)$

## 9. 模型验证与评估

### 9.1 收敛性分析

算法收敛条件：
$$\lim_{k \to \infty} \|\mathbf{f}^{(k+1)} - \mathbf{f}^{(k)}\| = 0$$

### 9.2 稳定性分析

对于输入扰动 $\delta\mathbf{S}$，输出变化满足：
$$\|\delta\mathbf{T}\| \leq L\|\delta\mathbf{S}\|$$

其中L是Lipschitz常数。

## 10. 理论创新点

### 10.1 维度扩展映射

首次提出4→5通道的系统性转换框架，解决了欠定映射问题。

### 10.2 自适应压缩策略

基于V通道强度的动态压缩因子，提高了高饱和度颜色的转换质量。

### 10.3 感知一致性保持

在数学优化的基础上，兼顾了人眼视觉感知特性。

这个数学模型为4通道到5通道的颜色转换提供了完整的理论基础，具有较强的实用性和扩展性。
