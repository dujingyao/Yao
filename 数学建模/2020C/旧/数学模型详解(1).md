# 中小微企业信贷策略数学模型与可视化分析

## 1. 数学模型构建

### 1.1 问题描述与约束条件

某银行对确定要放贷的企业制定如下约束条件：
- 贷款额度：10万元 ≤ L ≤ 100万元
- 年利率：4% ≤ r ≤ 15%
- 贷款期限：T = 1年

### 1.2 符号定义

| 符号 | 含义 | 单位 |
|------|------|------|
| $L_i$ | 第i家企业的贷款额度 | 万元 |
| $r_i$ | 第i家企业的年利率 | % |
| $R_i$ | 第i家企业的综合风险评分 | [0,1] |
| $C_i$ | 第i家企业的信誉评级 | {A,B,C,D} |
| $D_i$ | 第i家企业的历史违约标识 | {0,1} |
| $F_i$ | 第i家企业的财务状况评分 | [0,1] |
| $Q_i$ | 第i家企业的发票质量评分 | [0,1] |
| $S_i$ | 第i家企业的业务稳定性评分 | [0,1] |
| $P_i$ | 第i家企业的违约概率 | [0,1] |
| $E_i$ | 第i家企业的预期收益 | 万元 |
| $B$ | 银行总预算 | 万元 |

### 1.3 综合风险评分模型

#### 1.3.1 风险评分公式

综合风险评分采用加权线性组合：

$$R_i = w_1 \cdot R_{C_i} + w_2 \cdot D_i + w_3 \cdot R_{F_i} + w_4 \cdot R_{Q_i} + w_5 \cdot R_{S_i}$$

其中权重分配为：
- $w_1 = 0.35$ (信誉评级权重)
- $w_2 = 0.25$ (历史违约权重)  
- $w_3 = 0.20$ (财务状况权重)
- $w_4 = 0.15$ (发票质量权重)
- $w_5 = 0.05$ (业务稳定权重)

#### 1.3.2 各维度风险评分

**1) 信誉评级风险评分**
$$R_{C_i} = \begin{cases}
0.1 & \text{if } C_i = A \\
0.3 & \text{if } C_i = B \\
0.6 & \text{if } C_i = C \\
0.9 & \text{if } C_i = D
\end{cases}$$

**2) 历史违约风险评分**
$$R_{D_i} = 0.8 \cdot D_i + 0.1 \cdot (1-D_i)$$

**3) 财务状况风险评分**
基于毛利率的标准化逆向评分：
$$R_{F_i} = 1 - \frac{\text{毛利率}_i - \min(\text{毛利率})}{\max(\text{毛利率}) - \min(\text{毛利率})}$$python3 计算主营业务收入.py

**4) 发票质量风险评分**
$$R_{Q_i} = \frac{\text{作废发票数量}_i}{\text{总发票数量}_i}$$

**5) 业务稳定性风险评分**
基于业务活跃度的标准化逆向评分：
$$R_{S_i} = 1 - \frac{\ln(1+\text{年发票总量}_i) - \min(\ln(1+\text{年发票总量}))}{\max(\ln(1+\text{年发票总量})) - \min(\ln(1+\text{年发票总量}))}$$

### 1.4 结合附件3的数据映射与处理

附件3为企业原始数据表，需将其字段与模型变量对应，具体如下：

#### 1.4.1 数据字段与模型变量映射

- 年营业收入：$Y_i$，用于额度计算。
- 主营业务收入、主营业务成本：用于计算毛利率，$\text{毛利率}_i = \frac{\text{主营业务收入}_i - \text{主营业务成本}_i}{\text{主营业务收入}_i}$。
  - **统计方法说明**：主营业务收入和主营业务成本一般来源于企业年度财务报表（如利润表），在附件3中可直接查找对应字段。如果附件3为多期数据，则以最近一年数据为准；如有季度或月度数据，需按年度合计。若数据分散在多个表格，需按企业编号汇总。
- 企业信用等级：映射为信誉评级 $C_i$，如A、B、C、D。
- 逾期/违约记录：有则 $D_i=1$，无则 $D_i=0$。
- 总发票数量、作废发票数量：分别记为 $\text{总发票数量}_i$、$\text{作废发票数量}_i$。
- 年发票总量：$\text{年发票总量}_i$，用于业务稳定性评分。

#### 1.4.2 数据预处理步骤

1. **缺失值处理**：对缺失的主营业务收入、成本、发票等数据，采用均值/中位数插补或剔除异常企业。
2. **异常值检测**：如毛利率为负或大于1，发票数量为0等，需人工核查或剔除。
3. **标准化处理**：毛利率、发票总量等需归一化或标准化，便于后续评分。

#### 1.4.3 特征计算公式

1. **毛利率计算**：
   $$
   \text{毛利率}_i = \frac{\text{主营业务收入}_i - \text{主营业务成本}_i}{\text{主营业务收入}_i}
   $$
2. **财务状况评分**：
   $$
   R_{F_i} = 1 - \frac{\text{毛利率}_i - \min(\text{毛利率})}{\max(\text{毛利率}) - \min(\text{毛利率})}
   $$
3. **发票质量评分**：
   $$
   R_{Q_i} = \frac{\text{作废发票数量}_i}{\text{总发票数量}_i}
   $$
4. **业务稳定性评分**：
   $$
   R_{S_i} = 1 - \frac{\ln(1+\text{年发票总量}_i) - \min(\ln(1+\text{年发票总量}))}{\max(\ln(1+\text{年发票总量})) - \min(\ln(1+\text{年发票总量}))}
   $$

#### 1.4.4 风险评分与额度、利率计算流程

1. **信誉评级风险评分**：
   $$
   R_{C_i} = 
   \begin{cases}
   0.1 & C_i = A \\
   0.3 & C_i = B \\
   0.6 & C_i = C \\
   0.9 & C_i = D
   \end{cases}
   $$
2. **历史违约风险评分**：
   $$
   R_{D_i} = 0.8 \cdot D_i + 0.1 \cdot (1-D_i)
   $$
3. **综合风险评分**：
   $$
   R_i = 0.35 R_{C_i} + 0.25 R_{D_i} + 0.20 R_{F_i} + 0.15 R_{Q_i} + 0.05 R_{S_i}
   $$
4. **基础额度计算**（根据 $C_i$ 和 $D_i$，年营业收入 $Y_i$）：
   $$
   L_{base,i} = 
   \begin{cases}
   \min(100, \max(10, 0.25 Y_i)) & C_i = A, D_i = 0 \\
   \min(80, \max(10, 0.15 Y_i)) & C_i = A, D_i = 1 \\
   \min(80, \max(10, 0.20 Y_i)) & C_i = B, D_i = 0 \\
   \min(60, \max(10, 0.12 Y_i)) & C_i = B, D_i = 1 \\
   \min(50, \max(10, 0.10 Y_i)) & C_i = C, D_i = 0 \\
   \min(30, \max(10, 0.08 Y_i)) & C_i = C, D_i = 1 \\
   0 & C_i = D
   \end{cases}
   $$
5. **财务状况调整**：
   $$
   L_{adj,i} = 
   \begin{cases}
   \min(100, L_{base,i} \times 1.2) & \text{毛利率}_i > 0.3 \\
   L_{base,i} \times 0.7 & \text{毛利率}_i < 0 \\
   L_{base,i} & \text{otherwise}
   \end{cases}
   $$
6. **最终额度确定**：
   $$
   L_i = 
   \begin{cases}
   \min(100, \max(10, L_{adj,i})) & L_{adj,i} \geq 10 \\
   0 & L_{adj,i} < 10
   \end{cases}
   $$
7. **基础利率计算**：
   $$
   r_{base,i} = 
   \begin{cases}
   0.045 + 0.02 R_i & C_i = A, D_i = 0 \\
   0.055 + 0.03 R_i & C_i = A, D_i = 1 \\
   0.055 + 0.03 R_i & C_i = B, D_i = 0 \\
   0.070 + 0.04 R_i & C_i = B, D_i = 1 \\
   0.080 + 0.05 R_i & C_i = C, D_i = 0 \\
   0.100 + 0.05 R_i & C_i = C, D_i = 1
   \end{cases}
   $$
8. **利率约束**：
   $$
   r_i = \max(0.04, \min(0.15, r_{base,i}))
   $$
9. **违约概率计算**：
   $$
   P_i = \min(0.95, R_i \times 1.1)
   $$
10. **预期收益计算**：
    $$
    E_i = L_i \times r_i \times (1 - P_i)
    $$
11. **风险调整收益**：
    $$
    RAR_i = \frac{E_i}{L_i \times R_i + 0.01}
    $$

#### 1.4.5 预算分配优化流程

1. 计算所有企业的 $RAR_i$。
2. 按 $RAR_i$ 降序排列。
3. 依次分配贷款额度 $L_i$，直到预算 $B$ 耗尽。
4. 对于最后一家企业，分配剩余预算（若 $\geq 10$ 万元）。

#### 1.4.6 流程总结

综上，附件3数据需经过预处理、特征计算、风险评分、额度与利率决策、违约概率与收益计算，最后按风险调整收益优化分配贷款额度。所有公式和流程可直接用于论文建模部分。

### 1.5 利率定价模型

#### 1.5.1 基础利率计算

基础利率根据信誉评级和风险评分确定：

$$r_{base,i} = \begin{cases}
0.045 + 0.02 \times R_i & \text{if } C_i = A \text{ and } D_i = 0 \\
0.055 + 0.03 \times R_i & \text{if } C_i = A \text{ and } D_i = 1 \\
0.055 + 0.03 \times R_i & \text{if } C_i = B \text{ and } D_i = 0 \\
0.070 + 0.04 \times R_i & \text{if } C_i = B \text{ and } D_i = 1 \\
0.080 + 0.05 \times R_i & \text{if } C_i = C \text{ and } D_i = 0 \\
0.100 + 0.05 \times R_i & \text{if } C_i = C \text{ and } D_i = 1
\end{cases}$$

#### 1.5.2 利率约束

$$r_i = \max(0.04, \min(0.15, r_{base,i}))$$

### 1.6 违约概率模型

违约概率基于综合风险评分建模：

$$P_i = \min(0.95, R_i \times 1.1)$$

### 1.7 收益优化模型

#### 1.7.1 预期收益计算

$$E_i = L_i \times r_i \times (1 - P_i)$$

#### 1.7.2 风险调整收益

$$RAR_i = \frac{E_i}{L_i \times R_i + 0.01}$$

#### 1.7.3 优化目标函数

最大化银行总预期收益：

$$\max \sum_{i=1}^{n} E_i = \sum_{i=1}^{n} L_i \times r_i \times (1 - P_i)$$

#### 1.7.4 约束条件

1. **预算约束**：$\sum_{i=1}^{n} L_i \leq B$
2. **额度约束**：$10 \leq L_i \leq 100$ (对于获贷企业)
3. **利率约束**：$0.04 \leq r_i \leq 0.15$
4. **逻辑约束**：$L_i \geq 0, r_i \geq 0$

### 1.8 预算分配优化算法

当总需求超过预算时，按风险调整收益排序分配：

1. 计算所有企业的风险调整收益 $RAR_i$
2. 按 $RAR_i$ 降序排列
3. 依次分配贷款，直到预算耗尽
4. 对于最后一家企业，分配剩余预算（如果≥10万元）

## 2. 问题2：无信贷记录企业风险量化分析模型

### 2.1 模型背景与目标

针对302家无信贷记录企业，完全基于发票数据构建风险评估体系，在1亿元预算约束下实现最优信贷资源配置。

### 2.2 符号定义扩展

| 符号 | 含义 | 单位/范围 |
|------|------|-----------|
| $E_i^{(2)}$ | 第i家无信贷记录企业 | $i = 1,2,...,302$ |
| $R_i^{(2)}$ | 第i家企业的综合风险评分 | $[0,1]$ |
| $Y_i^{(2)}$ | 第i家企业的年收入（基于销项发票） | 万元 |
| $C_i^{(2)}$ | 第i家企业的年采购额（基于进项发票） | 万元 |
| $H_{c,i}^{(2)}$ | 第i家企业的客户集中度 | $[0,1]$ |
| $H_{s,i}^{(2)}$ | 第i家企业的供应商集中度 | $[0,1]$ |
| $F_{inv,i}^{(2)}$ | 第i家企业的发票作废率 | $[0,1]$ |

### 2.3 AHP权重体系

#### 2.3.1 五维度评估框架

建立判断矩阵：
$$A^{(2)} = \begin{pmatrix}
1 & 2 & 3 & 4 & 5 \\
1/2 & 1 & 2 & 3 & 4 \\
1/3 & 1/2 & 1 & 2 & 3 \\
1/4 & 1/3 & 1/2 & 1 & 2 \\
1/5 & 1/4 & 1/3 & 1/2 & 1
\end{pmatrix}$$

得到权重向量：
$$W^{(2)} = [0.419, 0.263, 0.160, 0.097, 0.061]^T$$

对应五个维度：
- $w_1^{(2)} = 0.419$ (财务状况)
- $w_2^{(2)} = 0.263$ (业务稳定性)
- $w_3^{(2)} = 0.160$ (发票质量)
- $w_4^{(2)} = 0.097$ (经营规模)
- $w_5^{(2)} = 0.061$ (增长潜力)

#### 2.3.2 一致性检验
- $CI = 0.027$, $RI = 1.12$, $CR = 0.024 < 0.1$ ✓

### 2.4 风险评分子模型

#### 2.4.1 财务状况评分 $R_{fin,i}^{(2)}$

**毛利率：**
$$M_i^{(2)} = \frac{Y_i^{(2)} - C_i^{(2)}}{Y_i^{(2)}}$$

**收入成本比：**
$$RC_i^{(2)} = \frac{Y_i^{(2)}}{C_i^{(2)}}$$

**收入稳定性：**
$$S_{rev,i}^{(2)} = 1 - \frac{\sigma_{rev,i}}{\mu_{rev,i}}$$

**财务评分：**
$$R_{fin,i}^{(2)} = 0.4 \cdot \text{norm}(M_i^{(2)}) + 0.3 \cdot \text{norm}(RC_i^{(2)}) + 0.3 \cdot \text{norm}(S_{rev,i}^{(2)})$$

#### 2.4.2 业务稳定性评分 $R_{bus,i}^{(2)}$

**客户集中度（HHI指数）：**
$$H_{c,i}^{(2)} = \sum_{j=1}^{N_{c,i}} \left(\frac{Y_{ij}}{Y_i^{(2)}}\right)^2$$

**供应商集中度：**
$$H_{s,i}^{(2)} = \sum_{k=1}^{N_{s,i}} \left(\frac{C_{ik}}{C_i^{(2)}}\right)^2$$

**业务稳定性评分：**
$$R_{bus,i}^{(2)} = 0.4(1-H_{c,i}^{(2)}) + 0.3(1-H_{s,i}^{(2)}) + 0.3 \cdot \text{norm}(T_i^{(2)})$$

#### 2.4.3 发票质量评分 $R_{inv,i}^{(2)}$

**发票质量评分：**
$$R_{inv,i}^{(2)} = 1 - [0.6 \cdot F_{inv,i}^{(2)} + 0.4 \cdot F_{neg,i}^{(2)}]$$

#### 2.4.4 经营规模评分 $R_{sca,i}^{(2)}$

$$R_{sca,i}^{(2)} = 0.4 \cdot \text{norm}(Y_i^{(2)}) + 0.3 \cdot \text{norm}(N_{c,i}) + 0.3 \cdot \text{norm}(N_{s,i})$$

#### 2.4.5 增长潜力评分 $R_{gro,i}^{(2)}$

$$R_{gro,i}^{(2)} = 0.6 \cdot \text{norm}(M_i^{(2)}) + 0.4 \cdot \text{norm}(T_i^{(2)})$$

### 2.5 综合风险评分模型

$$R_i^{(2)} = \sum_{j=1}^{5} w_j^{(2)} \cdot R_{j,i}^{(2)}$$

$$R_i^{(2)} = 0.419R_{fin,i}^{(2)} + 0.263R_{bus,i}^{(2)} + 0.160R_{inv,i}^{(2)} + 0.097R_{sca,i}^{(2)} + 0.061R_{gro,i}^{(2)}$$

### 2.6 信贷策略优化模型

#### 2.6.1 贷款额度计算

**基础额度：**
$$L_{base,i}^{(2)} = \begin{cases}
\min(100, \max(10, Y_i^{(2)} \times 0.0003 \times R_i^{(2)})) & \text{if } R_i^{(2)} \geq 0.2 \\
0 & \text{if } R_i^{(2)} < 0.2
\end{cases}$$

**风险等级约束：**
$$L_{i}^{(2)} = \min(L_{base,i}^{(2)}, L_{limit}(Risk\_Level_i))$$

#### 2.6.2 利率定价模型

$$r_i^{(2)} = \max(0.04, \min(0.15, 0.04 + (1-R_i^{(2)}) \times 0.11 + r_{adj}(Risk\_Level_i)))$$

#### 2.6.3 预算分配优化

**目标函数：**
$$\max Z^{(2)} = \sum_{i=1}^{302} L_i^{(2)} \times r_i^{(2)} \times R_i^{(2)}$$

**约束条件：**
$$\sum_{i=1}^{302} L_i^{(2)} \leq 10000 \text{ (万元)}$$
$$0 \leq L_i^{(2)} \leq L_{limit,i}^{(2)}, \quad 0.04 \leq r_i^{(2)} \leq 0.15$$

### 2.7 模型实施结果

#### 2.7.1 风险分布
- 中风险企业：158家 (52.3%)
- 较低风险企业：130家 (43.0%)
- 高风险企业：13家 (4.3%)
- 低风险企业：1家 (0.3%)

#### 2.7.2 信贷配置结果
- 批准企业：100家 (33.1%)
- 总放贷：10,000万元
- 平均额度：100万元
- 平均利率：10.74%

### 2.8 两个问题的模型对比

| 维度 | 问题1 (有信贷记录) | 问题2 (无信贷记录) |
|------|------------------|------------------|
| 数据基础 | 信贷记录+发票数据 | 纯发票数据 |
| 企业数量 | 123家 | 302家 |
| 风险维度 | 5维度 | 5维度 |
| 权重方法 | 经验权重 | AHP科学权重 |
| 额度上限 | 100万元 | 500万元 |
| 预算约束 | 1亿元 | 1亿元 |

### 2.9 模型创新点

1. **纯发票数据建模**：首次实现基于发票数据的企业信用评估
2. **科学权重体系**：采用AHP方法确定评估权重
3. **多维度量化**：财务、业务、发票、规模、增长五维评估
4. **动态风险定价**：风险评分与利率联动机制
